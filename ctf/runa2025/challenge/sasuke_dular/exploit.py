#!/usr/bin/env python3
"""
사스케 문제 분석:
- 스케줄 관리 프로그램
- g_names: 7일 * 11시간 * 8바이트 = 616바이트
- g_lens: 77바이트
- PIE 없음, NX 있음, 카나리 없음
- libc 2.39 제공 → ret2libc

취약점 찾기:
1. 배열 인덱스 검증 부족
2. GOT overwrite 가능성
3. 스택 오버플로우

전략:
1. leak libc (puts GOT → puts 주소)
2. ROP로 system("/bin/sh")
"""

from pwn import *

binary = './sasuke_dular'
elf = ELF(binary)
libc = ELF('./libc.so.6')

def register(target, day, start, end, name):
    target.sendlineafter(b'> ', b'1')
    target.sendlineafter(b'day (Mon=1,Sun=7):', str(day).encode())
    target.sendlineafter(b'hour (8-18):', str(start).encode())
    target.sendlineafter(b'hour (8-18):', str(end).encode())
    target.sendafter(b'name:', name)

def show(target):
    target.sendlineafter(b'> ', b'2')

def clear(target, day):
    target.sendlineafter(b'> ', b'3')
    target.sendlineafter(b'day (Mon=1,Sun=7):', str(day).encode())

if __name__ == '__main__':
    target = process(binary)
    
    # Test: register a normal entry
    register(target, 1, 8, 10, b'A' * 8)
    
    # Test: show schedule
    show(target)
    
    target.interactive()
